{% extends "base.html" %}

{% block title %}{{ quiz[1] }} - í€´ì¦ˆ ìƒì„¸ë³´ê¸°{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-2">
                    <i class="fas fa-door-open me-2"></i>{{ quiz[1] }}
                </h1>
                <small class="text-muted">
                    <i class="fas fa-calendar me-1"></i>
                    ìƒì„±ì¼: {{ quiz[6] }}
                </small>
            </div>
            <div>
                <!-- ì´ì „/ë‹¤ìŒ í€´ì¦ˆ í¸ì§‘ ë²„íŠ¼ -->
                <div class="btn-group me-2" role="group">
                    {% if prev_quiz_id %}
                    <a href="{{ url_for('edit_quiz_page', quiz_id=prev_quiz_id) }}" class="btn btn-outline-primary btn-sm" title="ì´ì „ í€´ì¦ˆ í¸ì§‘">
                        <i class="fas fa-chevron-left me-1"></i>ì´ì „ í¸ì§‘
                    </a>
                    {% endif %}
                    {% if next_quiz_id %}
                    <a href="{{ url_for('edit_quiz_page', quiz_id=next_quiz_id) }}" class="btn btn-outline-primary btn-sm" title="ë‹¤ìŒ í€´ì¦ˆ í¸ì§‘">
                        <i class="fas fa-chevron-right me-1"></i>ë‹¤ìŒ í¸ì§‘
                    </a>
                    {% endif %}
                </div>
                
                <a href="{{ url_for('admin_console') }}" class="btn btn-secondary me-2">
                    <i class="fas fa-arrow-left me-1"></i>ê´€ë¦¬ì ì½˜ì†”
                </a>
                <a href="{{ url_for('edit_quiz_page', quiz_id=quiz[0]) }}" class="btn btn-primary me-2">
                    <i class="fas fa-edit me-1"></i>í¸ì§‘
                </a>
                <button type="button" class="btn btn-danger" onclick="deleteQuiz()">
                    <i class="fas fa-trash me-1"></i>ì‚­ì œ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- í€´ì¦ˆ ìƒì„¸ ì •ë³´ -->
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-body">
                <!-- ë°©ì˜ ë°°ê²½ ë¬˜ì‚¬ -->
                <div class="mb-4">
                    {% if quiz[6] %}
                    <!-- ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš° -->
                    <div class="text-center mb-3">
                        <img src="{{ url_for('static', filename='images/' + quiz[6]) }}" 
                             class="img-fluid rounded shadow" style="max-height: 400px; object-fit: cover;"
                             alt="{{ quiz[1] }} ë°°ê²½ ì´ë¯¸ì§€">
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <div class="bg-light p-3 rounded text-center">
                                <i class="fas fa-home fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <h5 class="text-muted mb-2">
                                <i class="fas fa-home me-2"></i>ë°©ì˜ ë°°ê²½ ë¬˜ì‚¬
                            </h5>
                            <p class="lead" style="white-space: pre-wrap;">{{ quiz[2] }}</p>
                        </div>
                    </div>
                    {% else %}
                    <!-- ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš° -->
                    <div class="row">
                        <div class="col-md-2">
                            <div class="bg-light p-3 rounded text-center">
                                <i class="fas fa-image fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <h5 class="text-muted mb-2">
                                <i class="fas fa-home me-2"></i>ë°©ì˜ ë°°ê²½ ë¬˜ì‚¬
                            </h5>
                            <p class="lead" style="white-space: pre-wrap;">{{ quiz[2] }}</p>
                            <div class="mt-3">
                                <a href="{{ url_for('admin_console') }}" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-upload me-1"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸°
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <hr>

                <!-- ë¬¸ì œ -->
                <div class="mb-4">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="bg-primary bg-opacity-10 p-3 rounded text-center">
                                <i class="fas fa-question fa-2x text-primary"></i>
                            </div>
                        </div>
                                                 <div class="col-md-10">
                             <h5 class="text-primary mb-2">
                                 <i class="fas fa-puzzle-piece me-2"></i>ë¬¸ì œ
                             </h5>
                             <p class="fs-5" style="white-space: pre-wrap;">{{ quiz[3] }}</p>
                         </div>
                    </div>
                </div>

                <hr>

                <!-- íŒíŠ¸ -->
                <div class="mb-4">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <i class="fas fa-lightbulb fa-2x text-info"></i>
                            </div>
                        </div>
                                                 <div class="col-md-10">
                             <h5 class="text-info mb-2">
                                 <i class="fas fa-lightbulb me-2"></i>íŒíŠ¸
                             </h5>
                             <p class="fs-5 text-info" style="white-space: pre-wrap;">{{ quiz[4] }}</p>
                         </div>
                    </div>
                </div>

                <hr>

                <!-- ë‹µ -->
                <div class="mb-0">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="bg-success bg-opacity-10 p-3 rounded text-center">
                                <i class="fas fa-check-circle fa-2x text-success"></i>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <h5 class="text-success mb-2">
                                <i class="fas fa-key me-2"></i>ì •ë‹µ
                            </h5>
                            <div class="alert alert-success">
                                <h4 class="mb-0 fw-bold">{{ quiz[5] }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ì—°ì† í¸ì§‘ ë„¤ë¹„ê²Œì´ì…˜ -->
{% if prev_quiz_id or next_quiz_id %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow border-primary">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-edit me-2"></i>ì—°ì† í¸ì§‘
                </h6>
            </div>
            <div class="card-body text-center">
                <p class="text-muted mb-3">ë‹¤ë¥¸ í€´ì¦ˆë¥¼ ë°”ë¡œ í¸ì§‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="d-flex justify-content-center gap-3">
                    {% if prev_quiz_id %}
                    <a href="{{ url_for('edit_quiz_page', quiz_id=prev_quiz_id) }}" class="btn btn-outline-primary">
                        <i class="fas fa-chevron-left me-2"></i>ì´ì „ í€´ì¦ˆ í¸ì§‘
                    </a>
                    {% endif %}
                    <a href="{{ url_for('edit_quiz_page', quiz_id=quiz[0]) }}" class="btn btn-primary">
                        <i class="fas fa-edit me-2"></i>í˜„ì¬ í€´ì¦ˆ í¸ì§‘
                    </a>
                    {% if next_quiz_id %}
                    <a href="{{ url_for('edit_quiz_page', quiz_id=next_quiz_id) }}" class="btn btn-outline-primary">
                        <i class="fas fa-chevron-right me-2"></i>ë‹¤ìŒ í€´ì¦ˆ í¸ì§‘
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- ë°©íƒˆì¶œ ê²Œì„ ì‹œë®¬ë ˆì´ì…˜ -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-gamepad me-2"></i>ê²Œì„ ì‹œë®¬ë ˆì´ì…˜
                </h6>
            </div>
            <div class="card-body">
                <div id="gameSimulation" class="text-center">
                                         <div class="mb-3">
                         <i class="fas fa-door-closed fa-3x text-primary mb-2"></i>
                         <h5>{{ quiz[1] }}ì— ê°‡í˜”ìŠµë‹ˆë‹¤!</h5>
                         <p class="text-muted" style="white-space: pre-wrap;">{{ quiz[2] }}</p>
                     </div>
                    
                    <div class="mb-3">
                        <button type="button" class="btn btn-primary" onclick="showQuestion()">
                            <i class="fas fa-search me-1"></i>ë¬¸ì œ í™•ì¸í•˜ê¸°
                        </button>
                    </div>

                    <!-- ë¬¸ì œ í‘œì‹œ ì˜ì—­ -->
                    <div id="questionArea" style="display: none;" class="mb-3">
                                                 <div class="alert alert-info">
                             <h6>ğŸ“ ë¬¸ì œ</h6>
                             <p class="mb-0" style="white-space: pre-wrap;">{{ quiz[3] }}</p>
                         </div>
                        
                        <div class="row">
                            <div class="col-md-6 mx-auto">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="userAnswer" placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...">
                                    <button class="btn btn-success" type="button" onclick="checkAnswer()">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="showHint()">
                                <i class="fas fa-lightbulb me-1"></i>íŒíŠ¸ ë³´ê¸°
                            </button>
                        </div>
                        
                                                 <!-- íŒíŠ¸ í‘œì‹œ ì˜ì—­ -->
                         <div id="hintArea" style="display: none;" class="alert alert-warning">
                             <h6>ğŸ’¡ íŒíŠ¸</h6>
                             <p class="mb-0" style="white-space: pre-wrap;">{{ quiz[4] }}</p>
                         </div>
                    </div>

                    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                    <div id="resultArea" style="display: none;">
                        <!-- ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    í€´ì¦ˆ ì‚­ì œ í™•ì¸
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>ì •ë§ë¡œ ì´ í€´ì¦ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <p class="text-primary fw-bold">{{ quiz[1] }}</p>
                <p class="text-danger"><strong>ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                <form method="POST" action="{{ url_for('delete_quiz_route', quiz_id=quiz[0]) }}" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>ì‚­ì œ
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const correctAnswer = "{{ quiz[5] }}";

function showQuestion() {
    document.getElementById('questionArea').style.display = 'block';
    document.getElementById('userAnswer').focus();
}

function showHint() {
    document.getElementById('hintArea').style.display = 'block';
}

function checkAnswer() {
    const userAnswer = document.getElementById('userAnswer').value.trim();
    const resultArea = document.getElementById('resultArea');
    
    if (!userAnswer) {
        alert('ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
    }
    
    if (userAnswer === correctAnswer) {
        resultArea.innerHTML = `
            <div class="alert alert-success">
                <h5><i class="fas fa-trophy me-2"></i>ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</h5>
                <p class="mb-2">ì¶•í•˜í•©ë‹ˆë‹¤! ${document.querySelector('h1').textContent.replace('ğŸšª ', '')}ì—ì„œ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤!</p>
                <button type="button" class="btn btn-success" onclick="resetGame()">
                    <i class="fas fa-redo me-1"></i>ë‹¤ì‹œ ë„ì „í•˜ê¸°
                </button>
            </div>
        `;
        
        // confetti íš¨ê³¼ (ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜)
        showCelebration();
    } else {
        resultArea.innerHTML = `
            <div class="alert alert-danger">
                <h6><i class="fas fa-times me-2"></i>í‹€ë ¸ìŠµë‹ˆë‹¤!</h6>
                <p class="mb-2">ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. íŒíŠ¸ë¥¼ ì°¸ê³ í•´ë³´ì„¸ìš”!</p>
                <button type="button" class="btn btn-warning btn-sm" onclick="showHint()">
                    <i class="fas fa-lightbulb me-1"></i>íŒíŠ¸ ë³´ê¸°
                </button>
            </div>
        `;
    }
    
    resultArea.style.display = 'block';
}

function showCelebration() {
    // ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    const celebration = document.createElement('div');
    celebration.innerHTML = 'ğŸ‰ ESCAPE SUCCESS! ğŸ‰';
    celebration.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        font-weight: bold;
        color: #28a745;
        z-index: 9999;
        animation: bounce 1s ease-in-out;
    `;
    
    document.body.appendChild(celebration);
    
    setTimeout(() => {
        document.body.removeChild(celebration);
    }, 2000);
}

function resetGame() {
    document.getElementById('questionArea').style.display = 'none';
    document.getElementById('hintArea').style.display = 'none';
    document.getElementById('resultArea').style.display = 'none';
    document.getElementById('userAnswer').value = '';
}

function deleteQuiz() {
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}

// Enter í‚¤ë¡œ ë‹µ ì œì¶œ
document.getElementById('userAnswer').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        checkAnswer();
    }
});

// CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
const style = document.createElement('style');
style.textContent = `
    @keyframes bounce {
        0%, 20%, 60%, 100% {
            transform: translate(-50%, -50%) scale(1);
        }
        40% {
            transform: translate(-50%, -50%) scale(1.2);
        }
        80% {
            transform: translate(-50%, -50%) scale(1.1);
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %} 